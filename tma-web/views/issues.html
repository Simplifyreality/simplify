<header>
	<div class="row">
		<div class="small-12 medium-12 large-12 columns">
			<h1 class="left mr-20" translate="issues.title"></h1>
			<span class="left">
				<a href="" class="button radius mr-8" ng-click="showFilterModal()">
          <i class="fa fa-filter"></i> {{'issues.filters' | translate}}
        </a>
        <a download href="{{exportUrl()}}" class="button radius margin-reset" ng-show="!hasPermission('ROLE_JL_ISSUES_READONLY')">
          <i class="fa fa-table"></i> {{'issues.export' | translate}}
        </a>
      </span>
		</div>
	</div>
</header>

<div class="row flexbox-va mt-15 ng-scope">
	<div class="small-12 medium-12 large-12 columns">
		<span class="filter-tag" ng-show="options.dateFrom">
			<span class="left">{{'filter.dateFrom' | translate}}: {{options.dateFrom}}</span>
			<a href="" ng-click="removeSelectedFilter('dateFrom')" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
		<span class="filter-tag" ng-show="options.dateTo">
			<span class="left">{{'filter.dateTo' | translate}}: {{options.dateTo}}</span>
			<a href="" ng-click="removeSelectedFilter('dateTo')" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
		<span class="filter-tag" ng-show="options.trainNumbers" ng-repeat="t in options.trainNumbers">
			<span class="left">{{'filter.title.trainNumber' | translate}}: {{t}}</span>
			<a href="" ng-click="removeSelectedFilter('trainNumbers', t)" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
		<span class="filter-tag" ng-show="options.setNumbers" ng-repeat="t in options.setNumbers">
			<span class="left">{{'filter.title.setNumber' | translate}}: {{t}}</span>
			<a href="" ng-click="removeSelectedFilter('setNumbers', t)" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
		<span class="filter-tag" ng-show="options.category">
			<span class="left">{{'filter.title.category' | translate}}: {{options.category}}</span>
			<a href="" ng-click="removeSelectedFilter('category')" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
		<span class="filter-tag" ng-show="options.subcategory">
			<span class="left">{{'filter.title.subcategory' | translate}}: {{options.subcategory}}</span>
			<a href="" ng-click="removeSelectedFilter('subcategory')" class="right close"><i class="fa fa-times-circle"></i></a>
		</span>
	</div>
</div>

<!-- Start issues table -->
<div class="issues-table mt-15">
	<table width="100%" ng-init="list()">
		<thead>
			<tr>
				<th translate="issues.table.dateReported"></th>
				<th translate="issues.table.trainNumber"></th>
				<th translate="issues.table.journeyDate"></th>
				<th translate="issues.table.category"></th>
				<th translate="issues.table.subcategory"></th>
				<th translate="issues.table.description"></th>
				<th translate="issues.table.attachment"></th>
			</tr>
		</thead>
		<tbody>

			<tr ng-repeat="i in results.content">
				<td><a href="#/issues/{{i.id}}" ng-show="i.id">{{i.created | date:['dd-MM-yyyy HH:mm']}}</a></td>
				<td>{{i.trainNumber}}</td>
				<td>{{i.journeyDate | date:'dd-MM-yyyy'}}</td>
				<td>{{i.category}}</td>
				<td>{{i.subCategory}}</td>
				<!-- FIXME: This should be a list of passengers -->
				<td>{{i.description.split('\n')[0]}}</td>
				<td style="text-align: center">
					<img ng-if="i.photos" src="../img/attach_icon.png" alt="attach icon">
				</td>
			</tr>
		</tbody>
	</table>
	<div pagination content="results" callback="changePage"></div>
</div>
<!-- End issues table -->

<!-- filter modal -->
<div class="overlay" ng-show="showFilters"></div>
<div class="row" id="issues-filters" ng-show="showFilters">
	<div class="small-4 medium-3 large-2 columns filter-nav off-canvas">
		<!-- Start header -->
		<div class="row">
			<div class="small-12 medium-12 large-12 columns">
				<a href="" class="right close-button" ng-click="hideFilterModal()"><i class="fa fa-times"></i></a>
			</div>
		</div>
		<div class="row flexbox-va">
			<div class="small-12 medium-12 large-12 columns">
				<header>
					<h2 translate="filter.title"></h2>
				</header>
			</div>
		</div>
		<!-- End header -->

		<!-- Start Accordion -->
		<div class="section-container accordion">
			<!-- Start Date Range -->
			<section ng-class="{active : filterView == 'dateFrom'}">
				<p class="title" data-section-title>
					<a href="" ng-click="switchFilterView('dateFrom')" class="filter-heading" translate="filter.title.dateRange"></a>
				</p>
				<div class="content" data-section-content>
					<div class="row filter-options">
						<div class="small-4 medium-4 large-3 columns">
							<label for="date-from" class="inline left" translate="filter.dateFrom"></label>
						</div>
						<div class="small-8 medium-8 large-9 columns">
							<input type="text" id="date-from" ng-model="filters.dateFrom" placeholder="{{'filter.dateFrom.placeholder' | translate}}"  data-date-format="dd-mm-yyyy">
						</div>
					</div>
					<div class="row filter-options">
						<div class="small-4 medium-4 large-3 columns">
							<label for="date-to" class="inline left" translate="filter.dateTo"></label>
						</div>
						<div class="small-8 medium-8 large-9 columns">
							<input type="text" id="date-to" ng-model="filters.dateTo" placeholder="{{'filter.dateTo.placeholder' | translate}}"  data-date-format="dd-mm-yyyy">
						</div>
					</div>
				</div>
			</section>
			<!-- End Date Range -->
			<!-- Start Train no. -->
			<section ng-class="{active : filterView == 'trainNumber'}"  ng-show="!hasPermission('ROLE_JL_ISSUES_READONLY')">
				<p class="title" data-section-title>
					<a href="" ng-click="switchFilterView('trainNumber');" class="filter-heading" translate="filter.title.trainNumber"></a>
				</p>
				<div class="content" data-section-content>
					<div class="row filter-options">
						<div class="small-9 medium-9 large-9 columns">
							<input type="text" id="train-number" ng-model="trainNumberToAdd" placeholder="{{'filter.trainNumber.placeholder' | translate}}">
						</div>
						<div class="small-3 medium-3 large-3 columns">
							<a href="" class="button radius right margin-reset" ng-click="addFilter('trainNumbers', 'trainNumberToAdd')"><i class="fa fa-plus"></i> {{filter.button.add | translate}}</a>
						</div>
					</div>
					<!-- Start display of selected filters -->
					<div class="row filter-selections flexbox-va" ng-show="filters.trainNumbers">
						<span class="filter-tag" ng-repeat="t in filters.trainNumbers">
							<span class="left">{{t}}</span>
							<a href="" ng-click="removeFilter('trainNumbers', t)" class="right close"><i class="fa fa-times-circle"></i></a>
						</span>
					</div>
					<!-- End display of selected filters -->
				</div>
			</section>
			<!-- End train no. -->
			<!-- Start Set no. -->
			<section ng-class="{active : filterView == 'setNumber'}" ng-show="!hasPermission('ROLE_JL_ISSUES_READONLY')">
				<p class="title" data-section-title>
					<a href=""  ng-click="switchFilterView('setNumber')" class="filter-heading" translate="filter.title.setNumber"></a>
				</p>
				<div class="content" data-section-content>
					<div class="row flexbox-va filter-options">
						<div class="small-9 medium-9 large-9 columns">
							<input type="text" id="set-number-1" ng-model="setNumberToAdd" placeholder="{{'filter.setNumber.placeholder' | translate}}">
						</div>
						<div class="small-3 medium-3 large-3 columns">
							<a href="" class="button radius right margin-reset" ng-click="addFilter('setNumbers', 'setNumberToAdd')"><i class="fa fa-plus"></i> {{filter.button.add | translate}}</a>
						</div>
					</div>
					<!-- Start display of selected filters -->
					<div class="row filter-selections flexbox-va" ng-show="!!filters.setNumbers">
						<span class="filter-tag" ng-repeat="s in filters.setNumbers">
							<span class="left">{{s}}</span>
							<a href="" class="right close" ng-click="removeFilter('setNumbers', s)"><i class="fa fa-times-circle"></i></a>
						</span>
					</div>
					<!-- End display of selected filters -->
				</div>
			</section>
			<!-- End Set no. -->
			<!-- Start Categories section -->
			<section ng-class="{active : filterView == 'issues'}"  ng-show="!hasPermission('ROLE_JL_ISSUES_READONLY')">
				<p class="title" data-section-title>
					<a href="" ng-click="switchFilterView('issues')" class="filter-heading" translate="filter.title.issues"></a>
				</p>
				<div class="content" data-section-content>
					<!-- Start Status checkboxes -->
					<div class="filter-options">
						<div class="row">
							<div class="small-12 medium-12 large-12 columns">
								<select ng-options="t.title_en for t in categories" id="issues-category"  ng-model="filters.category" ng-change="changeFilterCategory()"></select>
							</div>
                            <!--<div form-select id="issues-category" select-values="filters.categories" ng-model="filter.category"></div>-->
						</div>
						<div class="row">
							<div class="small-12 medium-12 large-12 columns">
                                <select ng-options="t.title_en for t in filters.category.subCategories" id="issues-subcategory" ng-model="filters.subcategory" ng-disabled="!filters.category.id" ></select>
							</div>
                            <!--<div form-select id="issues-subcategory" select-values="filters.subcategories" ng-model="filter.subcategory"></div>-->
						</div>
					</div>
					<!-- End Status section -->
				</div>
			</section>
			<!-- End Status section -->
		</div>
		<!-- End Accordion -->
		<!-- Start Apply button -->
		<div class="row mt-15">
			<div class="small-12 medium-12 large-12 columns flexbox-h-end">
				<a href="" class="button radius right margin-reset" translate="filter.button.apply" ng-click="applyFilters()"></a>
			</div>
		</div>
		<!-- End Apply button -->
	</div>
</div>
<!-- End filter modal -->